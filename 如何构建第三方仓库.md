# 如何构建第三方仓库
## 需求概览
- 耳机校准文件，使用最小相位FIR，以脉冲响应（.wav）的形式保存。
- 拥有 HTTPS 域名的服务器，仓库地址指向存放耳机校准文件的目录。
## 部署文件
目录文件结构参考：
```text
.
├── headphone_list.json           # 耳机列表描述文件
├── repo_info.json                # 仓库信息描述文件
├── inear_1_44.wav                # 耳机校准文件（采样率44.1kHz）
├── inear_1_48.wav                # 耳机校准文件（采样率48kHz）
├── inear_1_96.wav                # 耳机校准文件（采样率96kHz）
├── inear_1_192.wav               # 耳机校准文件（采样率192kHz）
├── hpopen_2_44.wav               # 耳机校准文件（采样率44.1kHz）
├── hpopen_2_48.wav               # 耳机校准文件（采样率48kHz）
├── hpopen_2_96.wav               # 耳机校准文件（采样率96kHz）
├── hpopen_2_192.wav              # 耳机校准文件（采样率1921kHz）
├── hpclose_3_44.wav              # 耳机校准文件（采样率44.1kHz）
├── hpclose_3_48.wav              # 耳机校准文件（采样率48kHz）
├── hpclose_3_96.wav              # 耳机校准文件（采样率96kHz）
├── hpclose_3_192.wav             # 耳机校准文件（采样率192kHz）
……
```
- 耳机校准文件的命名格式为`id_version_采样率`。
- 每个id都必须提供44.1、48、96、192四个采样率。
- 所有文件（headphone_list.json、repo_info.json和耳机校准文件）都放置在同一目录下。

headphone_list.json内容参考：
```
[
  {
    "id": "inear",
    "type": 0,
    "brandName": [
      "Brand",
      "品牌名"
    ],
    "modelName": [
      "Model Name",
      "型号名"
    ],
    "version": 1,
    "noDspOffsetDb": 0
  },
  {
    "id": "hpopen",
    "type": 1,
    "brandName": [
      "Brand"
    ],
    "modelName": [
      "Model Name",
      "型号名"
    ],
    "version": 2,
    "noDspOffsetDb": 1.5
  },
  {
    "id": "hpclose",
    "type": 2,
    "brandName": [
      "Brand",
      "品牌名"
    ],
    "modelName": [
      "Model Name"
    ],
    "version": 3,
    "noDspOffsetDb": -1
  }
]
```
`id`：耳机校准文件在该仓库内的唯一标识，不可重复。  
`type`：耳机类型，指定为以下三种之一：`0`代表入耳式，`1`代表开放头戴式，`2`代表封闭头戴式。  
`brandName`：品牌名，第二行为中文名，客户端在使用中文本地化时会显示第二行而非第一行。  
`modelName`：型号名，第二行为中文名，客户端在使用中文本地化时会显示第二行而非第一行。  
`version`：非0正整数，用于更新校准文件。新的校准文件应单调递增文件名里的version字段，该json文件内的字段也要同步为相同数字。客户端会根据该json文件内记录的id和version检索对应的校准文件，如果id增大则自动更新。  
`noDspOffsetDb`：单位为dB，由于部分耳机校准后的主观音量感受可能和校准前有显著差异，使用该值可以增大/减小校准前的音量。  

repo_info.json内容参考：
```
{
  "name": "仓库名称",
  "maintainer": "仓库维护者",
  "description": "仓库说明，用于向用户说明使用此仓库的注意事项"
}
```
`name`：不宜过长，UI仅提供不足一行的显示空间。
## 耳机校准要求
- 校准的目标曲线必须设置为平直频响，实际使用的目标曲线会在客户端通过EQ还原。
- 建议为所有校准文件设置-12dB的预增益，对绝大多数耳机来说这个数值能尽量提高音量且不容易过0。
- 测量用人工耳建议B&K 4195（入耳式）和GRAS RA0045+KB0060（头戴式），或补偿到近似值，以兼容用户使用默认仓库创建的目标频率响应。
